{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ minihome.display_name|default:minihome.slug }} | 미니홈</title>
  <link rel="icon" type="image/png" href="{% static 'images/satoshop-logo-1x1-favicon.png' %}">
  <link rel="shortcut icon" type="image/png" href="{% static 'images/satoshop-logo-1x1-favicon.png' %}">
  <link rel="apple-touch-icon" href="{% static 'images/satoshop-logo-1x1-favicon.png' %}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="{% static 'js/tailwind-config.js' %}"></script>
  <link rel="stylesheet" href="{% static 'minihome/css/landing.css' %}">
  <link rel="stylesheet" href="{% static 'minihome/css/backgrounds.css' %}">
  <script>
    (function() {
      let theme = 'light';
      try {
        const stored = localStorage.getItem('theme');
        if (stored) {
          theme = stored;
        } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          theme = 'dark';
        }
      } catch (e) {
        theme = 'light';
      }
      document.documentElement.classList.toggle('dark', theme === 'dark');
      document.documentElement.setAttribute('data-theme', theme);
    })();
  </script>
</head>
<body class="min-h-screen minihome-bg minihome-bg--{{ background_preset }} text-slate-100 text-sm">
  <svg xmlns="http://www.w3.org/2000/svg" width="256" height="256" viewBox="0 0 24 24" fill="none" stroke="#f7931a" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="minihome-glow" aria-hidden="true">
    <path d="M11.767 19.089c4.924.868 6.14-6.025 1.216-6.894m-1.216 6.894L5.86 18.047m5.908 1.042-.347 1.97m1.563-8.864c4.924.869 6.14-6.025 1.215-6.893m-1.215 6.893-3.94-.694m5.155-6.2L8.29 4.26m5.908 1.042.348-1.97M7.48 20.364l3.126-17.727"/>
  </svg>
  <main class="px-4 py-10">
    <div class="minihome-shell">
      <header class="text-center space-y-3">
        <p class="text-xs uppercase tracking-[0.4em] text-slate-400">Minihome</p>
        <h1 class="text-2xl font-semibold font-display">{{ minihome.display_name|default:minihome.slug }}</h1>
        {% if is_preview %}
          <span class="inline-flex items-center gap-2 text-xs px-3 py-1 rounded-full bg-indigo-500/20 text-indigo-200">미리보기 모드</span>
        {% endif %}
      </header>

      <div class="mt-8 space-y-6">
        {% for section in sections %}
          {% if section.type == 'brand_image' %}
            <section class="minihome-section-card">
              {% if section.data.image.url %}
                <img src="{{ section.data.image.url }}" alt="브랜드 이미지" class="w-full rounded-3xl shadow-lg">
              {% else %}
                <div class="minihome-empty">브랜드 이미지를 등록해주세요.</div>
              {% endif %}
            </section>
          {% endif %}

          {% if section.type == 'title' %}
            <section class="minihome-section-card text-center space-y-3">
              <h2 class="text-xl font-semibold">{{ section.data.title|default:'브랜드 타이틀' }}</h2>
              <p class="text-slate-300 whitespace-pre-line">{{ section.data.description|default:'' }}</p>
            </section>
          {% endif %}

          {% if section.type == 'gallery' %}
            <section class="minihome-section-card space-y-5">
              {% for item in section.data.items %}
                <div class="flex flex-col gap-4 {% if forloop.counter0|divisibleby:2 %}sm:flex-row{% else %}sm:flex-row-reverse{% endif %}">
                  <div class="sm:w-1/2">
                    {% if item.image.url %}
                      <img src="{{ item.image.url }}" alt="갤러리 이미지" class="rounded-2xl w-full h-48 object-cover">
                    {% else %}
                      <div class="minihome-empty h-48">이미지를 추가해주세요.</div>
                    {% endif %}
                  </div>
                  <div class="sm:w-1/2 flex items-center">
                    <div class="space-y-3">
                      <p class="text-slate-200 whitespace-pre-line">{{ item.description|default:'' }}</p>
                    </div>
                  </div>
                </div>
              {% empty %}
                <div class="minihome-empty">갤러리 아이템이 없습니다.</div>
              {% endfor %}
            </section>
          {% endif %}

          {% if section.type == 'mini_blog' %}
            <section class="minihome-section-card">
              <div class="flex items-center justify-between">
                <h3 class="text-sm font-semibold">미니 블로그</h3>
                <span class="text-xs text-slate-300">클릭해서 자세히 보기</span>
              </div>
              <div class="mt-4 grid gap-3 md:grid-cols-2" data-blog-list>
                {% for post in section.data.posts|slice:"::-1" %}
                  <div class="minihome-blog-item">
                    <button type="button" class="minihome-blog-card" data-blog-card data-text="{{ post.text|escape }}"
                      data-image0="{{ post.images.0.url|default:'' }}" data-image1="{{ post.images.1.url|default:'' }}"
                      data-image2="{{ post.images.2.url|default:'' }}" data-image3="{{ post.images.3.url|default:'' }}">
                      <div class="flex items-start gap-3">
                        <div class="flex-1 text-left">
                          <p class="line-clamp-3 text-slate-200">{{ post.text|default:'' }}</p>
                        </div>
                        {% if post.images.0.url %}
                          <img src="{{ post.images.0.url }}" alt="썸네일" class="h-16 w-16 rounded-xl object-cover">
                        {% endif %}
                      </div>
                    </button>
                  </div>
                {% empty %}
                  <div class="minihome-empty">등록된 글이 없습니다.</div>
                {% endfor %}
              </div>
              <div class="minihome-pagination hidden" data-blog-pagination>
                <button type="button" class="minihome-pagination-btn" data-page-prev>이전</button>
                <span class="minihome-pagination-text" data-page-indicator>1 / 1</span>
                <button type="button" class="minihome-pagination-btn" data-page-next>다음</button>
              </div>
            </section>
          {% endif %}

          {% if section.type == 'store' %}
            <section class="minihome-section-card space-y-3">
              <h3 class="text-sm font-semibold">매장</h3>
              <div class="grid gap-3 md:grid-cols-3">
                {% for store in section.data.stores %}
                  <div class="minihome-store-card">
                    {% if store.cover_image.url %}
                      <img src="{{ store.cover_image.url }}" alt="{{ store.name|default:'매장' }} 커버" class="h-32 w-full rounded-xl object-cover">
                    {% endif %}
                    <div class="space-y-1 flex-1">
                      <p class="font-semibold">{{ store.name|default:'매장' }}</p>
                      <p class="text-xs text-slate-300 break-words">{{ store.description|default:'' }}</p>
                    </div>
                    {% if store.map_url %}
                      <a class="minihome-link w-full justify-center text-center mt-auto" href="{{ store.map_url }}" target="_blank" rel="noopener">지도 열기</a>
                    {% endif %}
                  </div>
                {% empty %}
                  <div class="minihome-empty">등록된 매장이 없습니다.</div>
                {% endfor %}
              </div>
            </section>
          {% endif %}

          {% if section.type == 'infographic' %}
            <section class="minihome-section-card">
              {% if section.data.image.url %}
                <img src="{{ section.data.image.url }}" alt="인포그래픽" class="w-full h-auto rounded-3xl shadow-lg">
              {% else %}
                <div class="minihome-empty">인포그래픽 이미지를 등록해주세요.</div>
              {% endif %}
            </section>
          {% endif %}

          {% if section.type == 'cta' %}
            <section class="minihome-section-card">
              <div class="flex flex-col gap-4 md:flex-row md:items-start md:justify-between">
                <div class="space-y-3 md:flex-1">
                  <div class="flex items-center gap-4">
                    {% if section.data.profile_image.url %}
                      <img src="{{ section.data.profile_image.url }}" alt="프로필" class="h-16 w-16 rounded-2xl object-cover">
                    {% else %}
                      <div class="h-16 w-16 rounded-2xl bg-slate-800"></div>
                    {% endif %}
                    <div>
                      <h3 class="text-sm font-semibold">함께하기</h3>
                      <p class="text-xs text-slate-300">연락 또는 후원 정보를 확인하세요.</p>
                    </div>
                  </div>
                  <p class="text-slate-200 whitespace-pre-line">{{ section.data.description|default:'' }}</p>
                </div>
                <div class="flex flex-col gap-3 md:w-[340px]">
                  <div class="flex flex-col items-end gap-3 md:flex-row md:items-center md:justify-end md:gap-2">
                    <div class="md:flex-none md:self-center">
                      <div class="minihome-cta-buttons">
                        {% if section.data.email %}
                          <a class="minihome-link minihome-copy justify-center text-center break-words" href="mailto:{{ section.data.email }}" data-copy-text="{{ section.data.email }}">이메일: {{ section.data.email }}</a>
                        {% endif %}
                        {% if section.data.donation %}
                          <span class="minihome-chip minihome-copy justify-center text-center break-words" role="button" tabindex="0" data-copy-text="{{ section.data.donation }}">⚡후원주소:{{ section.data.donation }}</span>
                        {% endif %}
                      </div>
                    </div>
                    {% if section.data.donation_qr.url %}
                      <div class="minihome-cta-qr">
                        <div class="h-24 w-24 rounded-2xl bg-white/90 p-2">
                          <img src="{{ section.data.donation_qr.url }}" alt="후원 QR" class="h-full w-full object-contain">
                        </div>
                      </div>
                    {% endif %}
                  </div>
                </div>
              </div>
            </section>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </main>

  {% if show_manage_link %}
    <a class="minihome-manage-fab" href="{{ manage_url }}">관리화면 이동</a>
  {% endif %}

  <div class="minihome-modal hidden" data-blog-modal>
    <div class="minihome-modal-panel">
      <div class="flex items-center justify-between">
        <h4 class="text-sm font-semibold">미니 블로그</h4>
        <button type="button" class="minihome-icon-btn" data-modal-close>닫기</button>
      </div>
      <p class="mt-3 text-slate-200 whitespace-pre-line" data-modal-text></p>
      <div class="mt-4 grid grid-cols-2 gap-3" data-modal-images></div>
    </div>
  </div>

  <script src="{% static 'minihome/js/landing.js' %}"></script>
</body>
</html>
