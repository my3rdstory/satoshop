name: í™˜ìœ¨ ìë™ ì—…ë°ì´íŠ¸

on:
  schedule:
    # 5ë¶„ë§ˆë‹¤ ì‹¤í–‰ (UTC ê¸°ì¤€)
    - cron: '*/5 * * * *'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼

jobs:
  update-exchange-rate:
    runs-on: ubuntu-latest
    
    steps:
    - name: í™˜ìœ¨ ì—…ë°ì´íŠ¸ ì›¹í›… í˜¸ì¶œ
      env:
        WEBHOOK_URL: ${{ secrets.WEBHOOK_URL }}
        WEBHOOK_TOKEN: ${{ secrets.WEBHOOK_TOKEN }}
      run: |
        echo "ğŸš€ GitHub Actionsì—ì„œ í™˜ìœ¨ ì—…ë°ì´íŠ¸ ì›¹í›… í˜¸ì¶œ ì‹œì‘"
        echo "ğŸ“¡ ì„œë²„ URL: ${WEBHOOK_URL}"
        
        response=$(curl -s -w "HTTPSTATUS:%{http_code}" \
          -X POST \
          -H "Content-Type: application/json" \
          -d "{\"token\": \"${WEBHOOK_TOKEN}\", \"source\": \"github_actions\"}" \
          "${WEBHOOK_URL}")
        
        body=$(echo "$response" | sed -E 's/HTTPSTATUS\:[0-9]{3}$//')
        code=$(echo "$response" | tr -d '\n' | sed -E 's/.*HTTPSTATUS:([0-9]{3})$/\1/')
        
        echo "ğŸ“Š ì‘ë‹µ ì½”ë“œ: $code"
        echo "ğŸ“„ ì‘ë‹µ ë‚´ìš©: $body"
        
        if [ "$code" -eq 200 ]; then
          echo "âœ… í™˜ìœ¨ ì—…ë°ì´íŠ¸ ì›¹í›… í˜¸ì¶œ ì„±ê³µ"
        else
          echo "âŒ í™˜ìœ¨ ì—…ë°ì´íŠ¸ ì›¹í›… í˜¸ì¶œ ì‹¤íŒ¨ (HTTP $code)"
          exit 1
        fi
    
    - name: ì‹¤í–‰ ê²°ê³¼ ì•Œë¦¼ (ì‹¤íŒ¨ ì‹œ)
      if: failure()
      run: |
        echo "âŒ í™˜ìœ¨ ì—…ë°ì´íŠ¸ ì›¹í›… í˜¸ì¶œ ì‹¤íŒ¨"
        echo "GitHub Actions ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”: https://github.com/${{ github.repository }}/actions"
        echo "ì„œë²„ ìƒíƒœë¥¼ í™•ì¸í•˜ê³  WEBHOOK_URLê³¼ WEBHOOK_TOKEN ì‹œí¬ë¦¿ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•˜ì„¸ìš”." 