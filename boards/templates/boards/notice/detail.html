{% extends 'myshop/base.html' %}
{% load static %}
{% load static_versioned %}

{% block title %}{{ notice.title }} - ê³µì§€ì‚¬í•­{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static_v 'css/boards.css' %}">
<style>
/* ë‹¤í¬ëª¨ë“œ ëŒ€ì‘ ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ */
.pinned-badge {
    margin-bottom: 15px; 
    display: inline-block;
}

.back-button {
    margin-bottom: 20px;
}
</style>
{% endblock %}

{% block content %}
<div class="notice-container">
    <!-- ë’¤ë¡œê°€ê¸° -->
    <div class="back-button">
        <a href="{% url 'boards:notice_list' %}" class="btn-notice btn-secondary">
            â† ëª©ë¡ìœ¼ë¡œ
        </a>
    </div>

    <!-- ê³µì§€ì‚¬í•­ ìƒì„¸ -->
    <div class="notice-detail">
        <!-- í—¤ë” -->
        <div class="notice-detail-header">
            {% if notice.is_pinned %}
                <span class="notice-badge pinned pinned-badge">ê³ ì •</span>
            {% endif %}
            <h1 class="notice-detail-title">{{ notice.title }}</h1>
            <div class="notice-detail-meta">
                <span>
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/>
                    </svg>
                    {{ notice.author.username }}
                </span>
                <span>
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M4 .5a.5.5 0 0 0-1 0V1H2a2 2 0 0 0-2 2v1h16V3a2 2 0 0 0-2-2h-1V.5a.5.5 0 0 0-1 0V1H4V.5zM16 14V5H0v9a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2z"/>
                    </svg>
                    {{ notice.created_at|date:"Yë…„ mì›” dì¼ H:i" }}
                </span>
                {% if notice.updated_at != notice.created_at %}
                    <span>
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M1.5 1a.5.5 0 0 0-.5.5v4a.5.5 0 0 1-1 0v-4A1.5 1.5 0 0 1 1.5 0h4a.5.5 0 0 1 0 1h-4zM11 .5a.5.5 0 0 1 .5-.5h4A1.5 1.5 0 0 1 17 1.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 0-.5-.5h-4a.5.5 0 0 1-.5-.5z"/>
                            <path d="M.5 11a.5.5 0 0 1 .5.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 0 15.5v-4a.5.5 0 0 1 .5-.5zm15 0a.5.5 0 0 1 .5.5v4a1.5 1.5 0 0 1-1.5 1.5h-4a.5.5 0 0 1 0-1h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 .5-.5z"/>
                        </svg>
                        ìˆ˜ì •: {{ notice.updated_at|date:"Y.m.d H:i" }}
                    </span>
                {% endif %}
                <span>
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>
                        <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>
                    </svg>
                    ì¡°íšŒìˆ˜ {{ notice.views }}
                </span>
            </div>
        </div>

        <!-- ë‚´ìš© -->
        <div class="notice-detail-content">
            {{ notice.content|linebreaks }}
        </div>

        <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
        {% if can_edit %}
            <div class="notice-detail-actions">
                <a href="{% url 'boards:notice_edit' pk=notice.pk %}" class="btn-notice btn-secondary">ìˆ˜ì •</a>
                <a href="{% url 'boards:notice_delete' pk=notice.pk %}" class="btn-notice btn-danger delete-notice-btn">ì‚­ì œ</a>
            </div>
        {% endif %}
    </div>

    <!-- ëŒ“ê¸€ ì„¹ì…˜ -->
    <div class="comments-section">
        <div class="comments-header">
            ëŒ“ê¸€ ({{ comments.count }})
        </div>

        <!-- ëŒ“ê¸€ ì‘ì„± í¼ -->
        <div class="comment-form">
            <form method="post" action="{% url 'boards:comment_create' notice_pk=notice.pk %}" class="comment-form">
                {% csrf_token %}
                <textarea name="content" 
                         placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." 
                         class="comment-textarea" 
                         required></textarea>
                <div class="comment-form-actions">
                    <button type="submit" class="btn-notice btn-primary">ëŒ“ê¸€ ì‘ì„±</button>
                </div>
            </form>
        </div>

        <!-- ëŒ“ê¸€ ëª©ë¡ -->
        {% if comments %}
            <div class="comments-list">
                {% for comment in comments %}
                    <div class="comment-item">
                        <!-- ëŒ“ê¸€ í—¤ë” -->
                        <div class="comment-header">
                            <span class="comment-author">{{ comment.author.username }}</span>
                            <span class="comment-date">{{ comment.created_at|date:"Y.m.d H:i" }}</span>
                        </div>

                        <!-- ëŒ“ê¸€ ë‚´ìš© -->
                        <div class="comment-content" id="comment-content-{{ comment.pk }}">
                            {{ comment.content|linebreaks }}
                        </div>

                        <!-- ëŒ“ê¸€ ìˆ˜ì • í¼ (ìˆ¨ê¹€) -->
                        <div class="comment-edit-form" id="edit-form-{{ comment.pk }}" style="display: none;">
                            <form method="post" action="{% url 'boards:comment_edit' comment_pk=comment.pk %}">
                                {% csrf_token %}
                                <textarea name="content" class="comment-textarea" required>{{ comment.content }}</textarea>
                                <div class="comment-form-actions">
                                    <button type="submit" class="btn-notice btn-success">ìˆ˜ì • ì™„ë£Œ</button>
                                    <button type="button" class="btn-notice btn-secondary edit-cancel-btn" data-comment-id="{{ comment.pk }}">ì·¨ì†Œ</button>
                                </div>
                            </form>
                        </div>

                        <!-- ëŒ“ê¸€ ì•¡ì…˜ -->
                        <div class="comment-actions">
                            <a href="#" class="comment-action reply-btn" data-comment-id="{{ comment.pk }}">ë‹µê¸€</a>
                            {% if user == comment.author %}
                                <a href="#" class="comment-action comment-edit-btn" data-comment-id="{{ comment.pk }}">ìˆ˜ì •</a>
                                <form method="post" action="{% url 'boards:comment_delete' comment_pk=comment.pk %}" style="display: inline;" class="comment-delete-form">
                                    {% csrf_token %}
                                    <button type="submit" class="comment-action" style="background: none; border: none; color: inherit; cursor: pointer;">ì‚­ì œ</button>
                                </form>
                            {% endif %}
                        </div>

                        <!-- ë‹µê¸€ ì‘ì„± í¼ (ìˆ¨ê¹€) -->
                        <div class="reply-form" id="reply-form-{{ comment.pk }}">
                            <form method="post" action="{% url 'boards:comment_create' notice_pk=notice.pk %}">
                                {% csrf_token %}
                                <input type="hidden" name="parent_id" value="{{ comment.pk }}">
                                <textarea name="content" 
                                         placeholder="ë‹µê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." 
                                         class="reply-textarea" 
                                         required></textarea>
                                <div class="comment-form-actions">
                                    <button type="submit" class="btn-notice btn-success">ë‹µê¸€ ì‘ì„±</button>
                                    <button type="button" class="btn-notice btn-secondary reply-cancel-btn" data-comment-id="{{ comment.pk }}">ì·¨ì†Œ</button>
                                </div>
                            </form>
                        </div>

                        <!-- ëŒ€ëŒ“ê¸€ ëª©ë¡ -->
                        {% for reply in comment.replies.all %}
                            {% if reply.is_active %}
                                <div class="reply-item">
                                    <div class="comment-header">
                                        <span class="comment-author">{{ reply.author.username }}</span>
                                        <span class="comment-date">{{ reply.created_at|date:"Y.m.d H:i" }}</span>
                                    </div>
                                    <div class="comment-content" id="comment-content-{{ reply.pk }}">
                                        {{ reply.content|linebreaks }}
                                    </div>
                                    
                                    <!-- ëŒ€ëŒ“ê¸€ ìˆ˜ì • í¼ (ìˆ¨ê¹€) -->
                                    <div class="comment-edit-form" id="edit-form-{{ reply.pk }}" style="display: none;">
                                        <form method="post" action="{% url 'boards:comment_edit' comment_pk=reply.pk %}">
                                            {% csrf_token %}
                                            <textarea name="content" class="comment-textarea" required>{{ reply.content }}</textarea>
                                            <div class="comment-form-actions">
                                                <button type="submit" class="btn-notice btn-success">ìˆ˜ì • ì™„ë£Œ</button>
                                                <button type="button" class="btn-notice btn-secondary edit-cancel-btn" data-comment-id="{{ reply.pk }}">ì·¨ì†Œ</button>
                                            </div>
                                        </form>
                                    </div>

                                    {% if user == reply.author %}
                                        <div class="comment-actions">
                                            <a href="#" class="comment-action comment-edit-btn" data-comment-id="{{ reply.pk }}">ìˆ˜ì •</a>
                                            <form method="post" action="{% url 'boards:comment_delete' comment_pk=reply.pk %}" style="display: inline;" class="comment-delete-form">
                                                {% csrf_token %}
                                                <button type="submit" class="comment-action" style="background: none; border: none; color: inherit; cursor: pointer;">ì‚­ì œ</button>
                                            </form>
                                        </div>
                                    {% endif %}
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">ğŸ’¬</div>
                <h3 class="empty-state-title">ì²« ëŒ“ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”</h3>
                <p class="empty-state-description">ì´ ê³µì§€ì‚¬í•­ì— ëŒ€í•œ ì˜ê²¬ì„ ë‚¨ê²¨ì£¼ì„¸ìš”.</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static_v 'js/boards.js' %}"></script>
{% endblock %} 