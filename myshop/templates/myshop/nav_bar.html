{% load user_extras %}
<!-- 플랫폼 브랜드 및 탐색 메뉴 컴포넌트 -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
  <div class="flex justify-between items-center h-16">
    <!-- 브랜드 로고 -->
    <div class="flex items-center">
      <a class="flex items-center space-x-2 text-white hover:text-bitcoin transition-colors" href="{% url 'myshop:home' %}?force_home=1">
        {% if site_settings and site_settings.site_logo_url %}
          <img src="{{ site_settings.site_logo_url }}" alt="{% if site_settings.site_title %}{{ site_settings.site_title }}{% else %}SatoShop{% endif %}" class="h-8 w-auto">
        {% else %}
          <strong class="text-xl">
            {% if site_settings and site_settings.site_title %}
              {{ site_settings.site_title }}
            {% else %}
              SatoShop
            {% endif %}
          </strong>
        {% endif %}
        <span class="bg-gray-700 text-white text-xs px-2 py-1 rounded">Hub</span>
      </a>
    </div>

    <!-- 데스크톱 네비게이션 -->
    <div class="hidden md:flex items-center space-x-8">
      <!-- Left Navigation - 플랫폼 탐색 -->
      <a class="text-gray-300 hover:text-bitcoin transition-colors flex items-center" href="{% url 'stores:browse_stores' %}">
        <i class="fas fa-search mr-2"></i>스토어 탐색
      </a>
      <a class="text-gray-300 hover:text-bitcoin transition-colors flex items-center" href="{% url 'stores:bah_promotion_request' %}">
        <i class="fas fa-store mr-2"></i>BAH 홍보요청
      </a>
      <a class="text-gray-300 hover:text-bitcoin transition-colors flex items-center" href="{% url 'boards:notice_list' %}">
        <i class="fas fa-bullhorn mr-2"></i>공지사항
      </a>
      <a class="text-gray-300 hover:text-bitcoin transition-colors flex items-center" href="{% url 'expert:landing' %}">
        <i class="fas fa-file-contract mr-2"></i>엑스퍼트
      </a>
      <div class="relative group">
        <button class="flex items-center text-gray-300 hover:text-bitcoin transition-colors">
          <i class="fas fa-link mr-2"></i>유용한 링크
          <i class="fas fa-chevron-down ml-1 text-xs"></i>
        </button>
        <div class="absolute left-0 mt-2 w-48 bg-gray-800 rounded-md shadow-lg py-2 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
          <a href="{% url 'boards:hall_of_fame_list' %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
            <i class="fas fa-trophy mr-2"></i>명예의전당
          </a>
          <a href="{% url 'boards:meme_list' %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
            <i class="fas fa-images mr-2"></i>밈갤러리
          </a>
        </div>
      </div>

      <!-- Right Navigation - 사용자별 메뉴 -->
      <div class="flex items-center space-x-4">
        
        {% if user.is_authenticated %}
        <!-- 사용자 드롭다운 -->
        <div class="relative group">
          <button class="flex items-center text-gray-300 hover:text-bitcoin transition-colors">
            <i class="fas fa-user mr-2"></i>{{ user|lightning_username_tail }}님
            <i class="fas fa-chevron-down ml-1 text-xs"></i>
          </button>
          <div class="absolute right-0 mt-2 w-48 bg-gray-800 rounded-md shadow-lg py-1 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
            <a href="{% url 'accounts:mypage' %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
              <i class="fas fa-user-cog mr-2"></i>마이페이지
            </a>
            <div class="border-t border-gray-600"></div>
            <a href="#" onclick="logout()" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
              <i class="fas fa-sign-out-alt mr-2"></i>로그아웃
            </a>
          </div>
        </div>

        {% if user_has_active_store and user_active_store.is_active %}
        <!-- 스토어 관리 드롭다운 -->
        <div class="relative group">
          <button class="flex items-center text-gray-300 hover:text-bitcoin transition-colors">
            <i class="fas fa-cog mr-2"></i>스토어 관리
            <i class="fas fa-chevron-down ml-1 text-xs"></i>
          </button>
          <div class="absolute right-0 mt-2 w-96 bg-gray-800 rounded-md shadow-lg py-1 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
            <!-- 2열 그리드 레이아웃 -->
            <div class="flex">
              <!-- 첫 번째 열 (왼쪽) -->
              <div class="w-1/2 border-r border-gray-600">
                <a href="{% url 'stores:my_stores' %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
                  <i class="fas fa-store mr-2"></i>스토어 관리
                </a>
                <a href="{% url 'stores:store_detail' store_id=user_active_store.store_id %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
                  <i class="fas fa-eye mr-2"></i>내 스토어 보기
                </a>
                <div class="border-t border-gray-600 mx-4"></div>
                <a href="{% url 'menu:menu_list' store_id=user_active_store.store_id %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
                  <i class="fas fa-utensils mr-2"></i>메뉴 관리
                </a>
                <a href="{% url 'menu:menu_orders' store_id=user_active_store.store_id %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
                  <i class="fas fa-chart-line mr-2"></i>메뉴 판매 현황
                </a>
                <a href="{% url 'menu:menu_board_desktop' store_id=user_active_store.store_id %}" target="_blank" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
                  <i class="fas fa-desktop mr-2"></i>메뉴판 이동(Desktop)
                </a>
                <a href="{% url 'menu:menu_board_mobile' store_id=user_active_store.store_id %}" target="_blank" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
                  <i class="fas fa-mobile-alt mr-2"></i>메뉴판 이동(Mobile)
                </a>
              </div>
              
              <!-- 두 번째 열 (오른쪽) -->
              <div class="w-1/2">
                <a href="{% url 'stores:product_list' store_id=user_active_store.store_id %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
                  <i class="fas fa-box mr-2"></i>상품관리
                </a>
                <a href="{% url 'orders:order_management' store_id=user_active_store.store_id %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
                  <i class="fas fa-shopping-cart mr-2"></i>주문관리
                </a>                
                <div class="border-t border-gray-600 mx-4"></div>
                <a href="{% url 'meetup:meetup_list' store_id=user_active_store.store_id %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
                  <i class="fas fa-users mr-2"></i>밋업 관리
                </a>
                <a href="{% url 'meetup:meetup_status' store_id=user_active_store.store_id %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
                  <i class="fas fa-chart-bar mr-2"></i>밋업 현황
                </a>
                <a href="{% url 'meetup:meetup_payment_transactions' store_id=user_active_store.store_id %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
                  <i class="fas fa-receipt mr-2"></i>결제 정보 확인
                </a>
                <div class="border-t border-gray-600 mx-4"></div>
                <a href="{% url 'lecture:live_lecture_list' store_id=user_active_store.store_id %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
                  <i class="fas fa-video mr-2"></i>라이브 강의 관리
                </a>
                <a href="{% url 'lecture:live_lecture_status' store_id=user_active_store.store_id %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
                  <i class="fas fa-chart-pie mr-2"></i>라이브 강의 현황
                </a>
                <a href="{% url 'lecture:live_lecture_payment_transactions' store_id=user_active_store.store_id %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
                  <i class="fas fa-receipt mr-2"></i>결제 정보 확인
                </a>
                <div class="border-t border-gray-600 mx-4"></div>
                <a href="{% url 'file:file_manage' store_id=user_active_store.store_id %}{% if request.GET.admin_access == 'true' %}?admin_access=true{% endif %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
                  <i class="fas fa-file-download mr-2"></i>파일 관리
                </a>
                <a href="{% url 'file:file_orders' store_id=user_active_store.store_id %}{% if request.GET.admin_access == 'true' %}?admin_access=true{% endif %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
                  <i class="fas fa-chart-area mr-2"></i>파일 현황
                </a>
                <a href="{% url 'file:file_payment_transactions' store_id=user_active_store.store_id %}{% if request.GET.admin_access == 'true' %}?admin_access=true{% endif %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
                  <i class="fas fa-receipt mr-2"></i>결제 정보 확인
                </a>
              </div>
            </div>
            
            <!-- 하단 공통 메뉴 -->
            <div class="border-t border-gray-600 mt-1"></div>
            <a href="#" onclick="toggleTheme(); return false;" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
              <span class="theme-toggle-menu-item">
                <i class="fas fa-sun theme-sun-icon" style="display: none;"></i>
                <i class="fas fa-moon theme-moon-icon mr-2"></i>
                <span class="theme-text">다크 모드로</span>
              </span>
            </a>
          </div>
        </div>
        {% else %}
        <!-- 설정 드롭다운 -->
        <div class="relative group">
          <button class="flex items-center text-gray-300 hover:text-bitcoin transition-colors">
            <i class="fas fa-cog mr-2"></i>설정
            <i class="fas fa-chevron-down ml-1 text-xs"></i>
          </button>
          <div class="absolute right-0 mt-2 w-48 bg-gray-800 rounded-md shadow-lg py-1 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
            <a href="{% url 'stores:create_store' %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
              <i class="fas fa-plus mr-2"></i>스토어 만들기
            </a>
            <div class="border-t border-gray-600"></div>
            <a href="#" onclick="toggleTheme(); return false;" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
              <span class="theme-toggle-menu-item">
                <i class="fas fa-sun theme-sun-icon" style="display: none;"></i>
                <i class="fas fa-moon theme-moon-icon mr-2"></i>
                <span class="theme-text">다크 모드로</span>
              </span>
            </a>
          </div>
        </div>
        {% endif %}

        {% else %}
        <!-- 비로그인 사용자 메뉴 -->
        <div class="relative group">
          <button class="flex items-center text-gray-300 hover:text-bitcoin transition-colors">
            <i class="fas fa-cog mr-2"></i>설정
            <i class="fas fa-chevron-down ml-1 text-xs"></i>
          </button>
          <div class="absolute right-0 mt-2 w-48 bg-gray-800 rounded-md shadow-lg py-1 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
            <a href="#" onclick="toggleTheme(); return false;" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
              <span class="theme-toggle-menu-item">
                <i class="fas fa-sun theme-sun-icon" style="display: none;"></i>
                <i class="fas fa-moon theme-moon-icon mr-2"></i>
                <span class="theme-text">다크 모드로</span>
              </span>
            </a>
            <div class="border-t border-gray-600"></div>
            <a href="#" onclick="redirectToSignup()" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
              <i class="fas fa-user-plus mr-2"></i>회원가입
            </a>
            <a href="#" onclick="redirectToLogin()" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
              <i class="fas fa-sign-in-alt mr-2"></i>로그인
            </a>
            <a href="{% url 'accounts:lightning_login' %}{% if request.GET.next %}?next={{ request.GET.next|urlencode }}{% endif %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
              <i class="fas fa-bolt mr-2"></i>라이트닝 로그인
            </a>
          </div>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- 모바일 메뉴 버튼 -->
    <div class="md:hidden">
      <button id="mobile-menu-button" class="flex items-center justify-center w-12 h-12 text-gray-300 hover:text-bitcoin hover:bg-gray-800 transition-colors rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 active:bg-gray-700 touch-manipulation" style="min-height: 44px; min-width: 44px;">
        <i class="fas fa-bars text-lg pointer-events-none"></i>
      </button>
    </div>
  </div>

  <!-- 모바일 메뉴 -->
  {% include 'myshop/mobile_menu.html' %}
</div> 
