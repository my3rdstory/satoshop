<!-- 플랫폼 브랜드 및 탐색 메뉴 컴포넌트 -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
  <div class="flex justify-between items-center h-16">
    <!-- 브랜드 로고 -->
    <div class="flex items-center">
      <a class="flex items-center space-x-2 text-gray-900 dark:text-white hover:text-bitcoin transition-colors" href="{% url 'myshop:home' %}?force_home=1">
        <strong class="text-xl">SatoShop</strong>
        <span class="bg-gray-800 dark:bg-gray-200 text-white dark:text-gray-800 text-xs px-2 py-1 rounded">Hub</span>
      </a>
    </div>

    <!-- 데스크톱 네비게이션 -->
    <div class="hidden md:flex items-center space-x-8">
      <!-- Left Navigation - 플랫폼 탐색 -->
      <a class="text-gray-700 dark:text-gray-300 hover:text-bitcoin transition-colors flex items-center" href="{% url 'stores:browse_stores' %}">
        <i class="fas fa-search mr-2"></i>스토어 탐색
      </a>

      <!-- Right Navigation - 사용자별 메뉴 -->
      <div class="flex items-center space-x-4">
        {% if user.is_authenticated %}
        <!-- 사용자 드롭다운 -->
        <div class="relative group">
          <button class="flex items-center text-gray-700 dark:text-gray-300 hover:text-bitcoin transition-colors">
            <i class="fas fa-user mr-2"></i>{{ user.username }}님
            <i class="fas fa-chevron-down ml-1 text-xs"></i>
          </button>
          <div class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg py-1 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
            <a href="{% url 'accounts:mypage' %}" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
              <i class="fas fa-user-cog mr-2"></i>마이페이지
            </a>
            <div class="border-t border-gray-100 dark:border-gray-600"></div>
            <a href="#" onclick="logout()" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
              <i class="fas fa-sign-out-alt mr-2"></i>로그아웃
            </a>
          </div>
        </div>

        {% if user_has_active_store and user_active_store.is_active %}
        <!-- 스토어 관리 드롭다운 -->
        <div class="relative group">
          <button class="flex items-center text-gray-700 dark:text-gray-300 hover:text-bitcoin transition-colors">
            <i class="fas fa-cog mr-2"></i>스토어 관리
            <i class="fas fa-chevron-down ml-1 text-xs"></i>
          </button>
          <div class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg py-1 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
            <a href="{% url 'stores:product_list' store_id=user_active_store.store_id %}" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
              <i class="fas fa-box mr-2"></i>상품관리
            </a>
            <a href="{% url 'orders:order_management' store_id=user_active_store.store_id %}" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
              <i class="fas fa-shopping-cart mr-2"></i>주문관리
            </a>
            <div class="border-t border-gray-100 dark:border-gray-600"></div>
            <a href="{% url 'stores:my_stores' %}" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
              <i class="fas fa-store mr-2"></i>스토어 관리
            </a>
            <div class="border-t border-gray-100 dark:border-gray-600"></div>
            <a href="{% url 'stores:store_detail' store_id=user_active_store.store_id %}" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
              <i class="fas fa-eye mr-2"></i>내 스토어 보기
            </a>
            <div class="border-t border-gray-100 dark:border-gray-600"></div>
            <a href="#" onclick="toggleTheme(); return false;" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
              <span class="theme-toggle-menu-item">
                <i class="fas fa-sun theme-sun-icon" style="display: none;"></i>
                <i class="fas fa-moon theme-moon-icon mr-2"></i>
                <span class="theme-text">다크 모드로</span>
              </span>
            </a>
          </div>
        </div>
        {% else %}
        <!-- 설정 드롭다운 -->
        <div class="relative group">
          <button class="flex items-center text-gray-700 dark:text-gray-300 hover:text-bitcoin transition-colors">
            <i class="fas fa-cog mr-2"></i>설정
            <i class="fas fa-chevron-down ml-1 text-xs"></i>
          </button>
          <div class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg py-1 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
            <a href="{% url 'stores:create_store' %}" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
              <i class="fas fa-plus mr-2"></i>스토어 만들기
            </a>
            <div class="border-t border-gray-100 dark:border-gray-600"></div>
            <a href="#" onclick="toggleTheme(); return false;" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
              <span class="theme-toggle-menu-item">
                <i class="fas fa-sun theme-sun-icon" style="display: none;"></i>
                <i class="fas fa-moon theme-moon-icon mr-2"></i>
                <span class="theme-text">다크 모드로</span>
              </span>
            </a>
          </div>
        </div>
        {% endif %}

        {% else %}
        <!-- 비로그인 사용자 메뉴 -->
        <div class="relative group">
          <button class="flex items-center text-gray-700 dark:text-gray-300 hover:text-bitcoin transition-colors">
            <i class="fas fa-cog mr-2"></i>설정
            <i class="fas fa-chevron-down ml-1 text-xs"></i>
          </button>
          <div class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg py-1 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
            <a href="#" onclick="toggleTheme(); return false;" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
              <span class="theme-toggle-menu-item">
                <i class="fas fa-sun theme-sun-icon" style="display: none;"></i>
                <i class="fas fa-moon theme-moon-icon mr-2"></i>
                <span class="theme-text">다크 모드로</span>
              </span>
            </a>
            <div class="border-t border-gray-100 dark:border-gray-600"></div>
            <a href="#" onclick="redirectToSignup()" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
              <i class="fas fa-user-plus mr-2"></i>회원가입
            </a>
            <a href="#" onclick="redirectToLogin()" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
              <i class="fas fa-sign-in-alt mr-2"></i>로그인
            </a>
          </div>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- 모바일 메뉴 버튼 -->
    <div class="md:hidden">
      <button id="mobile-menu-button" class="flex items-center justify-center w-12 h-12 text-gray-700 dark:text-gray-300 hover:text-bitcoin hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 active:bg-gray-200 dark:active:bg-gray-600 touch-manipulation">
        <i class="fas fa-bars text-xl pointer-events-none"></i>
      </button>
    </div>
  </div>

  <!-- 모바일 메뉴 -->
  <div id="mobile-menu" class="md:hidden hidden bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
    <div class="px-2 pt-2 pb-3 space-y-1">
      <a href="{% url 'stores:browse_stores' %}" class="block px-3 py-2 text-gray-700 dark:text-gray-300 hover:text-bitcoin hover:bg-gray-50 dark:hover:bg-gray-700 rounded-md">
        <i class="fas fa-search mr-2"></i>스토어 탐색
      </a>
      
      {% if user.is_authenticated %}
      <a href="{% url 'accounts:mypage' %}" class="block px-3 py-2 text-gray-700 dark:text-gray-300 hover:text-bitcoin hover:bg-gray-50 dark:hover:bg-gray-700 rounded-md">
        <i class="fas fa-user-cog mr-2"></i>마이페이지
      </a>
      
      {% if user_has_active_store and user_active_store.is_active %}
      <a href="{% url 'stores:product_list' store_id=user_active_store.store_id %}" class="block px-3 py-2 text-gray-700 dark:text-gray-300 hover:text-bitcoin hover:bg-gray-50 dark:hover:bg-gray-700 rounded-md">
        <i class="fas fa-box mr-2"></i>상품관리
      </a>
      <a href="{% url 'orders:order_management' store_id=user_active_store.store_id %}" class="block px-3 py-2 text-gray-700 dark:text-gray-300 hover:text-bitcoin hover:bg-gray-50 dark:hover:bg-gray-700 rounded-md">
        <i class="fas fa-shopping-cart mr-2"></i>주문관리
      </a>
      <a href="{% url 'stores:my_stores' %}" class="block px-3 py-2 text-gray-700 dark:text-gray-300 hover:text-bitcoin hover:bg-gray-50 dark:hover:bg-gray-700 rounded-md">
        <i class="fas fa-store mr-2"></i>스토어 관리
      </a>
      {% else %}
      <a href="{% url 'stores:create_store' %}" class="block px-3 py-2 text-gray-700 dark:text-gray-300 hover:text-bitcoin hover:bg-gray-50 dark:hover:bg-gray-700 rounded-md">
        <i class="fas fa-plus mr-2"></i>스토어 만들기
      </a>
      {% endif %}
      
      <a href="#" onclick="logout()" class="block px-3 py-2 text-gray-700 dark:text-gray-300 hover:text-bitcoin hover:bg-gray-50 dark:hover:bg-gray-700 rounded-md">
        <i class="fas fa-sign-out-alt mr-2"></i>로그아웃
      </a>
      {% else %}
      <a href="#" onclick="redirectToSignup()" class="block px-3 py-2 text-gray-700 dark:text-gray-300 hover:text-bitcoin hover:bg-gray-50 dark:hover:bg-gray-700 rounded-md">
        <i class="fas fa-user-plus mr-2"></i>회원가입
      </a>
      <a href="#" onclick="redirectToLogin()" class="block px-3 py-2 text-gray-700 dark:text-gray-300 hover:text-bitcoin hover:bg-gray-50 dark:hover:bg-gray-700 rounded-md">
        <i class="fas fa-sign-in-alt mr-2"></i>로그인
      </a>
      {% endif %}
      
      <a href="#" onclick="toggleTheme(); return false;" class="block px-3 py-2 text-gray-700 dark:text-gray-300 hover:text-bitcoin hover:bg-gray-50 dark:hover:bg-gray-700 rounded-md">
        <span class="theme-toggle-menu-item">
          <i class="fas fa-sun theme-sun-icon" style="display: none;"></i>
          <i class="fas fa-moon theme-moon-icon mr-2"></i>
          <span class="theme-text">다크 모드로</span>
        </span>
      </a>
    </div>
  </div>
</div>

<script>
// 모바일 메뉴 토글 (nav_bar.html용)
document.addEventListener('DOMContentLoaded', function() {
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  
  if (mobileMenuButton && mobileMenu) {
    // 메뉴 토글 함수
    function toggleMobileMenu(e) {
      if (e) {
        e.preventDefault();
        e.stopPropagation();
      }
      
      // 토글 처리
      const isHidden = mobileMenu.classList.contains('hidden');
      if (isHidden) {
        mobileMenu.classList.remove('hidden');
      } else {
        mobileMenu.classList.add('hidden');
      }
      
      // 아이콘 변경
      const icon = mobileMenuButton.querySelector('i');
      if (icon) {
        if (mobileMenu.classList.contains('hidden')) {
          icon.className = 'fas fa-bars text-xl pointer-events-none';
        } else {
          icon.className = 'fas fa-times text-xl pointer-events-none';
        }
      }
    }
    
    // 다양한 이벤트 리스너 추가 (모바일 호환성 향상)
    mobileMenuButton.addEventListener('click', toggleMobileMenu);
    mobileMenuButton.addEventListener('touchend', function(e) {
      e.preventDefault();
      e.stopPropagation();
      toggleMobileMenu();
    });
    
    // 메뉴 외부 클릭 시 닫기
    document.addEventListener('click', function(e) {
      if (!mobileMenu.contains(e.target) && !mobileMenuButton.contains(e.target)) {
        if (!mobileMenu.classList.contains('hidden')) {
          mobileMenu.classList.add('hidden');
          const icon = mobileMenuButton.querySelector('i');
          if (icon) {
            icon.className = 'fas fa-bars text-xl pointer-events-none';
          }
        }
      }
    });
    
    // ESC 키로 메뉴 닫기
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && !mobileMenu.classList.contains('hidden')) {
        mobileMenu.classList.add('hidden');
        const icon = mobileMenuButton.querySelector('i');
        if (icon) {
          icon.className = 'fas fa-bars text-xl pointer-events-none';
        }
      }
    });
  }
});
</script> 