## 배경
- 상품 결제 후 재고가 줄지 않고, 구매자 마이페이지의 구매 내역에 주문이 나타나지 않는 케이스가 보고됨.

## 원인
- 라이트닝 결제 플로우에서 결제 완료 후 `verify_payment`(프런트 폴링) 경로는 주문 생성/재고 차감/구매내역 생성을 수행하지만,
  사용자가 결제 직후 페이지를 닫는 등으로 해당 경로가 실행되지 않으면 `Blink webhook(receive.lightning)` 경로는 “입금 확인”까지만 기록하고
  주문 저장 단계(주문/구매내역/재고 차감)가 수행되지 않았음.

## 변경 사항
- `orders/services.py`에 `finalize_order_from_payment_transaction()` 추가
  - `PaymentTransaction.metadata`의 `shipping`, `cart_snapshot`을 기반으로 주문과 구매내역을 생성하고 재고를 차감.
  - 동일 `payment_id` 주문이 이미 존재하는 경우(결제 완료 후 주문은 생성됐지만 트랜잭션 연결이 누락된 상황 등) 중복 생성하지 않고 트랜잭션만 연결.
  - “수동 복구”로 분류되지 않도록 `manual_*` 메타/로그는 생성하지 않음(웹훅 자동 확정으로 기록).
- `ln_payment/views.py`의 `blink_webhook`에서 결제 입금 확인 후, 주문이 없는 상품 결제 트랜잭션에 대해 자동으로 주문 확정 수행.

## 영향
- 사용자가 결제 직후 브라우저를 닫아도 웹훅만 정상 수신되면 주문/재고/구매내역이 자동으로 확정되어 누락 이슈를 줄임.

## 대장 수동 테스트 가이드
1. 상품 재고를 2 이상으로 설정하고 장바구니에 담아 결제 플로우를 시작.
2. 인보이스 결제 후 결제 페이지를 새로고침/이탈(의도적으로 `verify_payment` 완료 전 종료).
3. 웹훅이 수신되도록 환경을 구성한 뒤(`POST /ln-payment/webhook/blink/`), 구매자 `마이페이지 → 구매 내역`에 주문이 생성되는지 확인.
4. 상품 상세/관리 화면에서 재고가 결제 수량만큼 감소했는지 확인.
