{% extends 'myshop/base.html' %}
{% load static %}

{% block title %}{{ store.store_name }} - SatoShop{% endblock %}

{% block meta_description %}{% if store and store.store_description %}{{ store.store_description|truncatewords:30 }}{% else %}SatoShop 스토어에서 비트코인으로 쇼핑하세요{% endif %}{% endblock %}

<!-- 스토어별 오픈그래프 설정 -->
{% block og_title %}{{ store.store_name }} - SatoShop{% endblock %}
{% block og_description %}{% if store and store.store_description %}{{ store.store_description|truncatewords:30 }}{% else %}SatoShop 스토어에서 비트코인으로 쇼핑하세요{% endif %}{% endblock %}
{% block og_type %}website{% endblock %}
{% block og_image %}{% if store and store.images.exists %}{{ store.images.first.file_url }}{% elif site_settings and site_settings.og_default_image %}{{ site_settings.og_default_image }}{% else %}{% static 'images/satoshop-logo-1x1-favicon.png' %}{% endif %}{% endblock %}

{% block twitter_title %}{{ store.store_name }} - SatoShop{% endblock %}
{% block twitter_description %}{% if store and store.store_description %}{{ store.store_description|truncatewords:30 }}{% else %}SatoShop 스토어에서 비트코인으로 쇼핑하세요{% endif %}{% endblock %}
{% block twitter_image %}{% if store and store.images.exists %}{{ store.images.first.file_url }}{% elif site_settings and site_settings.og_default_image %}{{ site_settings.og_default_image }}{% else %}{% static 'images/satoshop-logo-1x1-favicon.png' %}{% endif %}{% endblock %}

{% block body_class %} store-page{% if store %} store-{{ store.store_id }}{% endif %}{% endblock %}

{% block content %}
<!-- 스토어 메인 컨텐츠 -->
<div style="{% if store %}{% if store.hero_color1 and store.hero_color2 %}--hero-gradient: linear-gradient(135deg, {{ store.hero_color1 }}, {{ store.hero_color2 }});{% endif %}{% if store.hero_text_color %}--hero-text-color: {{ store.hero_text_color }};{% endif %}{% endif %}">
    <!-- 스토어 네비게이션 바 -->
    <nav class="bg-gray-900 shadow-sm border-b border-gray-700 fixed top-0 left-0 right-0 z-50" role="navigation" aria-label="main navigation">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
          <!-- 왼쪽 네비게이션 -->
          <div class="flex items-center space-x-4">
            <!-- 네비게이션 드롭다운 (데스크톱) -->
            <div class="relative group hidden md:block">
              <button class="flex items-center px-3 py-2 text-gray-300 hover:text-white transition-colors">
                <i class="fas fa-compass mr-2"></i>
                내비게이션
                <i class="fas fa-chevron-down ml-2 text-xs"></i>
              </button>
              <div class="absolute left-0 mt-2 w-48 bg-gray-800 rounded-md shadow-lg py-1 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
                <a href="{% url 'myshop:home' %}?force_home=1" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700">
                  <i class="fas fa-home mr-2"></i>Hub 메인으로
                </a>
                <a href="{% url 'stores:browse_stores' %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700">
                  <i class="fas fa-search mr-2"></i>스토어 탐색
                </a>
              </div>
            </div>

            <!-- 스토어 이름 -->
            {% if store.store_id %}
            <div class="flex items-center space-x-6">
              <a href="{% url 'stores:store_detail' store.store_id %}" class="flex items-center space-x-2 text-white hover:text-bitcoin transition-colors">
                <span class="font-bold">{{ store.store_name }}</span>
                <span class="px-2 py-1 bg-gray-700 text-white text-xs rounded">Store</span>
              </a>
              <!-- 상품 목록 버튼 (데스크톱에서만 표시) -->
              <a href="{% url 'products:public_product_list' store.store_id %}" class="hidden md:flex items-center px-3 py-1.5 text-gray-400 hover:text-white hover:bg-gray-800 text-sm rounded-md transition-colors border border-gray-600">
                <i class="fas fa-list mr-2 text-xs"></i>
                상품 목록
              </a>
            </div>
            {% else %}
            <div class="flex items-center space-x-2 text-white">
              <span class="font-bold">{{ store.store_name }}</span>
              <span class="px-2 py-1 bg-gray-700 text-white text-xs rounded">Store</span>
            </div>
            {% endif %}
          </div>

          <!-- 오른쪽 네비게이션 -->
          <div class="flex items-center space-x-4">
            <!-- 모바일 메뉴 버튼 -->
            <button id="mobile-menu-button" class="md:hidden flex items-center justify-center w-12 h-12 text-gray-300 hover:text-white hover:bg-gray-800 transition-colors rounded-lg touch-manipulation focus:outline-none focus:ring-2 focus:ring-blue-500 active:bg-gray-700" style="min-height: 44px; min-width: 44px;">
              <i class="fas fa-bars text-lg pointer-events-none"></i>
            </button>

            <!-- 데스크톱 메뉴 -->
            <div class="hidden md:flex items-center space-x-4">
              {% if user.is_authenticated %}
              <!-- 사용자 드롭다운 -->
              <div class="relative group">
                <button class="flex items-center px-3 py-2 text-gray-300 hover:text-white transition-colors">
                  <i class="fas fa-user mr-2"></i>
                  {{ user.username }}님
                  <i class="fas fa-chevron-down ml-2 text-xs"></i>
                </button>
                <div class="absolute right-0 mt-2 w-48 bg-gray-800 rounded-md shadow-lg py-1 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
                  <a href="{% url 'accounts:mypage' %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700">
                    <i class="fas fa-user-cog mr-2"></i>마이페이지
                  </a>
                  <div class="border-t border-gray-600"></div>
                  <a href="#" onclick="logout()" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700">
                    <i class="fas fa-sign-out-alt mr-2"></i>로그아웃
                  </a>
                </div>
              </div>

              {% if user_has_active_store and user_active_store.is_active %}
              <!-- 스토어 관리 드롭다운 -->
              <div class="relative group">
                <button class="flex items-center px-3 py-2 text-gray-300 hover:text-white transition-colors">
                  <i class="fas fa-cog mr-2"></i>
                  스토어 관리
                  <i class="fas fa-chevron-down ml-2 text-xs"></i>
                </button>
                <div class="absolute right-0 mt-2 w-48 bg-gray-800 rounded-md shadow-lg py-1 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
                  {% if user_active_store.store_id %}
                  <a href="{% url 'stores:product_list' store_id=user_active_store.store_id %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700">
                    <i class="fas fa-box mr-2"></i>상품관리
                  </a>
                  <a href="{% url 'orders:order_management' store_id=user_active_store.store_id %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700">
                    <i class="fas fa-shopping-cart mr-2"></i>주문관리
                  </a>
                  <div class="border-t border-gray-600"></div>
                  {% endif %}
                  <a href="{% url 'stores:my_stores' %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700">
                    <i class="fas fa-store mr-2"></i>스토어 관리
                  </a>
                  {% if user_active_store.store_id %}
                  <div class="border-t border-gray-600"></div>
                  <a href="{% url 'stores:store_detail' store_id=user_active_store.store_id %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700">
                    <i class="fas fa-eye mr-2"></i>내 스토어 보기
                  </a>
                  <a href="{% url 'boards:notice_list' %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700">
                    <i class="fas fa-bullhorn mr-2"></i>사이트 공지사항 확인
                  </a>
                  <div class="border-t border-gray-600"></div>
                  <a href="#" onclick="toggleTheme(); return false;" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700">
                    <span class="theme-toggle-menu-item">
                      <i class="fas fa-sun theme-sun-icon" style="display: none;"></i>
                      <i class="fas fa-moon theme-moon-icon mr-2"></i>
                      <span class="theme-text">다크 모드로</span>
                    </span>
                  </a>
                  {% endif %}
                </div>
              </div>
              {% else %}
              <!-- 일반 사용자 설정 드롭다운 -->
              <div class="relative group">
                <button class="flex items-center px-3 py-2 text-gray-300 hover:text-white transition-colors">
                  <i class="fas fa-cog mr-2"></i>
                  설정
                  <i class="fas fa-chevron-down ml-2 text-xs"></i>
                </button>
                <div class="absolute right-0 mt-2 w-48 bg-gray-800 rounded-md shadow-lg py-1 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
                  <a href="{% url 'stores:create_store' %}" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700">
                    <i class="fas fa-plus mr-2"></i>스토어 만들기
                  </a>
                  <div class="border-t border-gray-600"></div>
                  <a href="#" onclick="toggleTheme(); return false;" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700">
                    <span class="theme-toggle-menu-item">
                      <i class="fas fa-sun theme-sun-icon" style="display: none;"></i>
                      <i class="fas fa-moon theme-moon-icon mr-2"></i>
                      <span class="theme-text">다크 모드로</span>
                    </span>
                  </a>
                </div>
              </div>
              {% endif %}

              {% else %}
              <!-- 비로그인 사용자 설정 드롭다운 -->
              <div class="relative group">
                <button class="flex items-center px-3 py-2 text-gray-300 hover:text-white transition-colors">
                  <i class="fas fa-cog mr-2"></i>
                  설정
                  <i class="fas fa-chevron-down ml-2 text-xs"></i>
                </button>
                <div class="absolute right-0 mt-2 w-48 bg-gray-800 rounded-md shadow-lg py-1 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
                  <a href="#" onclick="toggleTheme(); return false;" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700">
                    <span class="theme-toggle-menu-item">
                      <i class="fas fa-sun theme-sun-icon" style="display: none;"></i>
                      <i class="fas fa-moon theme-moon-icon mr-2"></i>
                      <span class="theme-text">다크 모드로</span>
                    </span>
                  </a>
                  <div class="border-t border-gray-600"></div>
                  <a href="#" onclick="redirectToSignup()" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700">
                    <i class="fas fa-user-plus mr-2"></i>회원가입
                  </a>
                  <a href="#" onclick="redirectToLogin()" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700">
                    <i class="fas fa-sign-in-alt mr-2"></i>로그인
                  </a>
                </div>
              </div>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- 모바일 메뉴 -->
        {% include 'myshop/mobile_menu.html' %}
      </div>
    </nav>

    <!-- 스토어 전용 네비게이션 오버라이드 -->
    <nav class="bg-gray-900 shadow-sm border-b border-gray-700 fixed top-0 left-0 right-0 z-50" role="navigation" aria-label="store navigation">
      {% block store_navigation %}
      {% include 'stores/store_navigation.html' %}
      {% endblock %}
    </nav>

    <!-- 메인 컨텐츠 -->
    <main class="flex-1 pt-16">
      {% if messages %}
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
        {% for message in messages %}
        <div class="bg-{{ message.tags }}-100 dark:bg-{{ message.tags }}-900/30 border border-{{ message.tags }}-400 dark:border-{{ message.tags }}-600 text-{{ message.tags }}-700 dark:text-{{ message.tags }}-300 px-4 py-3 rounded-lg mb-4 relative">
          <button class="absolute top-0 bottom-0 right-0 px-4 py-3 text-{{ message.tags }}-500 hover:text-{{ message.tags }}-700 dark:hover:text-{{ message.tags }}-300" onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
          </button>
          {{ message }}
        </div>
        {% endfor %}
      </div>
      {% endif %}

      {% block store_content %}
      {% endblock %}
    </main>
  </div>
{% endblock %}

{% block footer %}
<!-- 스토어 전용 푸터 -->
<footer class="bg-gray-900 dark:bg-gray-950 text-white">
  <div class="max-w-7xl mx-auto px-4 py-8 text-center">
    <p class="text-lg mb-4">
      <strong class="text-bitcoin">{{ store.store_name }}</strong> - {{ store.owner_name }}
    </p>

    <!-- 연락처 정보 -->
    <div class="flex flex-wrap justify-center items-center gap-6 mb-6">
      {% if store.owner_phone %}
      <span class="flex items-center">
        <i class="fas fa-phone mr-2"></i>{{ store.owner_phone }}
      </span>
      {% endif %}
      {% if store.owner_email %}
      <span class="flex items-center">
        <i class="fas fa-envelope mr-2"></i>{{ store.owner_email }}
      </span>
      {% endif %}
      {% if store.chat_channel %}
      <span>
        <a href="{{ store.chat_channel }}" target="_blank" class="text-white hover:text-bitcoin transition-colors flex items-center">
          <i class="fas fa-comments mr-2"></i>소통채널
        </a>
      </span>
      {% endif %}
    </div>

    <!-- 사업자 정보 -->
    {% if store.business_license_number or store.telecommunication_sales_number %}
    <div class="flex flex-wrap justify-center items-center gap-6 mb-6 text-sm text-gray-400">
      {% if store.business_license_number %}
      <span class="flex items-center">
        <i class="fas fa-building mr-2"></i>사업자등록번호: {{ store.business_license_number }}
      </span>
      {% endif %}
      {% if store.telecommunication_sales_number %}
      <span class="flex items-center">
        <i class="fas fa-certificate mr-2"></i>통신판매업번호: {{ store.telecommunication_sales_number }}
      </span>
      {% endif %}
    </div>
    {% endif %}

    <!-- 사이트 공통 푸터 -->
    <div class="border-t border-gray-700 pt-4">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <!-- 카피라이트 -->
        <p class="text-gray-400 text-sm">
          {% if site_settings and site_settings.footer_copyright %}
            {{ site_settings.footer_copyright }}
          {% else %}
            © {% now "Y" %} SatoShop. All rights reserved.
          {% endif %}
        </p>
        
        <!-- 법적 문서 링크 (가운데) -->
        {% if documents %}
        <div class="mt-4 md:mt-0">
          <div class="flex flex-wrap justify-center gap-4 md:gap-6">
            {% if documents.terms %}
              <a href="{% url 'myshop:document' 'terms' %}" class="text-gray-300 hover:text-white text-sm transition-colors duration-200">
                {{ documents.terms.title }}
              </a>
            {% endif %}
            
            {% if documents.privacy %}
              <a href="{% url 'myshop:document' 'privacy' %}" class="text-red-400 font-bold hover:text-red-300 text-sm transition-colors duration-200">
                {{ documents.privacy.title }}
              </a>
            {% endif %}
            
            {% if documents.refund %}
              <a href="{% url 'myshop:document' 'refund' %}" class="text-gray-300 hover:text-white text-sm transition-colors duration-200">
                {{ documents.refund.title }}
              </a>
            {% endif %}
          </div>
        </div>
        {% endif %}
        
        <!-- 비트코인 아이콘 (오른쪽) -->
        <div class="flex items-center mt-4 md:mt-0">
          <span class="text-gray-400 text-sm mr-2">Powered by</span>
          <i class="fab fa-bitcoin text-bitcoin text-lg"></i>
          <span class="text-gray-400 text-sm ml-1">Bitcoin Lightning & SatoShop</span>
        </div>
      </div>
    </div>
  </div>
</footer>
{% endblock %}

<!-- 스토어 전용 JavaScript -->
<script>
  // Django URL과 CSRF 토큰을 전역 변수로 설정
  window.csrfToken = '{{ csrf_token }}';
  window.logoutUrl = "{% url 'accounts:logout' %}";
  window.loginUrl = "{% url 'accounts:login' %}";
  window.signupUrl = "{% url 'accounts:signup' %}";
  window.homeUrl = "{% url 'myshop:home' %}";
  {% if store.store_id %}
  window.storeId = "{{ store.store_id }}";
  {% endif %}
</script>
<link rel="stylesheet" href="{% static 'css/mobile-menu.css' %}">
<script src="{% static 'js/common.js' %}"></script>
<script src="{% static 'js/store-common.js' %}"></script>

{% block extra_js %}{% endblock %}