{% extends 'myshop/base.html' %}
{% load static %}

{% block title %}{{ store.store_name }} - SatoShop{% endblock %}

{% block meta_description %}{% if store and store.store_description %}{{ store.store_description|truncatewords:30 }}{% else %}SatoShop 스토어에서 비트코인으로 쇼핑하세요{% endif %}{% endblock %}

<!-- 스토어별 오픈그래프 설정 -->
{% block og_title %}{{ store.store_name }} - SatoShop{% endblock %}
{% block og_description %}{% if store and store.store_description %}{{ store.store_description|truncatewords:30 }}{% else %}SatoShop 스토어에서 비트코인으로 쇼핑하세요{% endif %}{% endblock %}
{% block og_type %}website{% endblock %}
{% block og_image %}{% if store and store.images.exists %}{{ store.images.first.file_url }}{% elif site_settings and site_settings.og_default_image %}{{ site_settings.og_default_image }}{% else %}{% static 'images/satoshop-logo-1x1-favicon.png' %}{% endif %}{% endblock %}

{% block twitter_title %}{{ store.store_name }} - SatoShop{% endblock %}
{% block twitter_description %}{% if store and store.store_description %}{{ store.store_description|truncatewords:30 }}{% else %}SatoShop 스토어에서 비트코인으로 쇼핑하세요{% endif %}{% endblock %}
{% block twitter_image %}{% if store and store.images.exists %}{{ store.images.first.file_url }}{% elif site_settings and site_settings.og_default_image %}{{ site_settings.og_default_image }}{% else %}{% static 'images/satoshop-logo-1x1-favicon.png' %}{% endif %}{% endblock %}

{% block body_class %} store-page{% if store %} store-{{ store.store_id }}{% endif %}{% endblock %}

{% block content %}
<!-- 스토어 메인 컨텐츠 -->
<div style="{% if store %}{% if store.hero_color1 and store.hero_color2 %}--hero-gradient: linear-gradient(135deg, {{ store.hero_color1 }}, {{ store.hero_color2 }});{% endif %}{% if store.hero_text_color %}--hero-text-color: {{ store.hero_text_color }};{% endif %}{% endif %}">
    <!-- 메인 컨텐츠 (사이트 공통 나브바는 base.html에서 처리) -->
    <main class="flex-1">
      {% if messages %}
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
        {% for message in messages %}
        <div class="bg-{{ message.tags }}-100 dark:bg-{{ message.tags }}-900/30 border border-{{ message.tags }}-400 dark:border-{{ message.tags }}-600 text-{{ message.tags }}-700 dark:text-{{ message.tags }}-300 px-4 py-3 rounded-lg mb-4 relative">
          <button class="absolute top-0 bottom-0 right-0 px-4 py-3 text-{{ message.tags }}-500 hover:text-{{ message.tags }}-700 dark:hover:text-{{ message.tags }}-300" onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
          </button>
          {{ message }}
        </div>
        {% endfor %}
      </div>
      {% endif %}

      {% block store_content %}
      {% endblock %}
    </main>

    <!-- 스토어 정보 섹션 -->
    <section class="bg-gray-100 dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
        <div class="text-center">
          <!-- 스토어 이름과 주인장 -->
          <div class="mb-2">
            <h3 class="text-base font-bold text-gray-900 dark:text-white">
              <i class="fas fa-store mr-2 text-blue-500"></i>
              {{ store.store_name }} - {{ store.owner_name }}
            </h3>
          </div>

          <!-- 사업자 정보 -->
          {% if store.business_license_number or store.telecommunication_sales_number %}
          <div class="flex flex-wrap justify-center items-center gap-4 text-xs text-gray-500 dark:text-gray-400">
            {% if store.business_license_number %}
            <span class="flex items-center">
              <i class="fas fa-building mr-1"></i>
              사업자등록번호: {{ store.business_license_number }}
            </span>
            {% endif %}
            {% if store.telecommunication_sales_number %}
            <span class="flex items-center">
              <i class="fas fa-certificate mr-1"></i>
              통신판매업번호: {{ store.telecommunication_sales_number }}
            </span>
            {% endif %}
          </div>
          {% endif %}
        </div>
      </div>
    </section>
  </div>
{% endblock %}

<!-- 스토어 전용 JavaScript -->
<script>
  // Django URL과 CSRF 토큰을 전역 변수로 설정
  window.csrfToken = '{{ csrf_token }}';
  window.logoutUrl = "{% url 'accounts:logout' %}";
  window.loginUrl = "{% url 'accounts:login' %}";
  window.signupUrl = "{% url 'accounts:signup' %}";
  window.homeUrl = "{% url 'myshop:home' %}";
  {% if store.store_id %}
  window.storeId = "{{ store.store_id }}";
  {% endif %}
</script>
<script src="{% static 'js/common.js' %}"></script>
<script src="{% static 'js/store-common.js' %}"></script>

{% block extra_js %}{% endblock %}